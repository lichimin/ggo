# 装备系统文档

## 1. 装备基础信息

### 1.1 装备品级
装备分为6个品级，从低到高依次为：
- 1级：普通
- 2级：稀有
- 3级：史诗
- 4级：传说
- 5级：神话
- 6级：创世

### 1.2 装备部位
装备分为6个部位：
- weapon：武器
- helmet：头盔
- chest：胸甲
- gloves：手套
- pants：护腿
- boots：鞋子

### 1.3 装备属性
#### 1.3.1 基础属性
- HP：生命值
- Attack：攻击力
- AttackSpeed：攻击速度
- MoveSpeed：移动速度
- BulletSpeed：子弹速度
- Drain：吸血
- Critical：暴击值
- Dodge：闪避值
- InstantKill：秒杀几率
- Recovery：生命恢复
- Trajectory：弹道数

#### 1.3.2 附加属性
装备可以通过锻造或融合获得附加属性，分为普通属性和稀有属性。

**普通附加属性：**
- 攻击力加成（1%~3%）
- 暴击率（1%~3%）
- 吸血（1%~3%）
- 减伤（1%~3%）
- 生命恢复（20~100）
- 固定攻击力（10~30）
- 血量加成（1%~5%）

**稀有附加属性（七宗罪）：**
- 傲慢：最大HP提升（5%~20%）
- 嫉妒：暴击伤害提升（10%~20%）
- 暴食：攻击速度提升（10%~20%）
- 贪婪：攻击时1%几率秒杀
- 色欲：生命恢复提升（100~200）
- 暴怒：暴击率提升（8%~10%）
- 怠惰：攻击力提升（5%~20%）

## 2. 宝物系统概述

### 2.1 宝物等级与装备锻造的关系
宝物是锻造装备的核心材料，分为6个等级，与装备的6个品级一一对应：
- 1级宝物：用于锻造普通装备
- 2级宝物：用于锻造稀有装备
- 3级宝物：用于锻造史诗装备
- 4级宝物：用于锻造传说装备
- 5级宝物：用于锻造神话装备
- 6级宝物：用于锻造创世装备

### 2.2 宝物获取方式
宝物可以通过以下方式获取：
- 游戏内任务奖励
- 关卡掉落
- 商店购买
- 活动奖励

### 2.3 宝物在锻造中的作用
在锻造装备时，系统会从3个选择的宝物中随机选择一个作为基准，以其等级决定锻造出的装备等级。

## 3. 装备锻造功能

### 3.1 功能概述
玩家可以使用3个宝物和金币锻造装备，锻造出的装备等级基于随机选择的一个宝物的等级。装备的品质和附加属性与所选宝物的等级密切相关。

### 3.2 锻造条件
- 消耗3个宝物（固定数量，可重复选择）
- 消耗5万金币（固定消耗）
- 宝物必须属于玩家且数量大于0

### 3.3 锻造流程
1. 玩家选择3个宝物进行锻造
2. 系统扣除3个宝物和5万金币
3. 从3个宝物中**随机选择一个**作为基准
4. 以选择的宝物等级作为新装备的等级
5. 从对应等级的装备模板中**随机选择**一个作为基础模板
6. 基于装备等级**随机生成附加属性**
7. 将新装备添加到玩家背包

### 3.4 装备等级与宝物等级的关系
锻造出的装备等级**完全基于随机选择的一个宝物的等级**，与其他两个宝物的等级无关。

| 选择的宝物等级 | 锻造出的装备等级 |
|--------------|----------------|
| 1级（普通）   | 1级（普通）     |
| 2级（稀有）   | 2级（稀有）     |
| 3级（史诗）   | 3级（史诗）     |
| 4级（传说）   | 4级（传说）     |
| 5级（神话）   | 5级（神话）     |
| 6级（创世）   | 6级（创世）     |

### 3.5 附加属性生成规则
锻造时，根据装备等级（即选择的宝物等级），有概率为装备生成附加属性：

#### 3.5.1 附加属性类型概率分布（所有等级相同）
- **50%概率**：生成稀有属性（七宗罪）
- **40%概率**：生成普通属性
- **10%概率**：无附加属性

#### 3.5.2 各等级宝物对应的附加属性详情

**1级宝物（普通）**
- 稀有属性：七宗罪属性，属性值范围为最小值
- 普通属性：普通附加属性，属性值范围为最小值
- 示例：
  - 稀有属性：傲慢·最大HP提升5%
  - 普通属性：攻击力加成1%

**2级宝物（稀有）**
- 稀有属性：七宗罪属性，属性值范围为最小值+5%
- 普通属性：普通附加属性，属性值范围为最小值+0.5%
- 示例：
  - 稀有属性：嫉妒·暴击伤害提升15%
  - 普通属性：暴击率1.5%

**3级宝物（史诗）**
- 稀有属性：七宗罪属性，属性值范围为最小值+10%
- 普通属性：普通附加属性，属性值范围为最小值+1%
- 示例：
  - 稀有属性：暴食·攻击速度提升20%
  - 普通属性：吸血2%

**4级宝物（传说）**
- 稀有属性：七宗罪属性，属性值范围为最小值+12%
- 普通属性：普通附加属性，属性值范围为最小值+1.5%
- 示例：
  - 稀有属性：贪婪·秒杀1%
  - 普通属性：减伤2.5%

**5级宝物（神话）**
- 稀有属性：七宗罪属性，属性值范围为最小值+15%
- 普通属性：普通附加属性，属性值范围为最小值+2%
- 示例：
  - 稀有属性：色欲·生命恢复150
  - 普通属性：生命恢复60

**6级宝物（创世）**
- 稀有属性：七宗罪属性，属性值范围为最大值
- 普通属性：普通附加属性，属性值范围为最大值
- 示例：
  - 稀有属性：暴怒·暴击率10%
  - 普通属性：攻击力+30

## 4. 装备强化功能

### 4.1 功能概述
玩家可以消耗金币强化装备，提升装备的强化等级。

### 4.2 强化条件
- 消耗金币，消耗金额基于装备等级
- 装备必须属于玩家

### 4.3 金币消耗规则
| 装备等级 | 消耗金币 |
|---------|---------|
| 1级     | 10000   |
| 2级     | 30000   |
| 3级     | 50000   |
| 4级     | 80000   |
| 5级     | 100000  |
| 6级     | 200000  |

### 4.4 强化成功率
| 当前强化等级 | 成功率 |
|------------|-------|
| 0级        | 90%   |
| 1级        | 90%   |
| 2级        | 90%   |
| 3级        | 80%   |
| 4级        | 80%   |
| 5级        | 70%   |
| 6级        | 70%   |
| 7级        | 70%   |
| 8级        | 60%   |
| 9级        | 60%   |
| 10级       | 50%   |
| 11级       | 50%   |
| 12级       | 50%   |
| 13级       | 40%   |
| 14级       | 40%   |
| 15级       | 30%   |
| 16级       | 30%   |
| 17级       | 30%   |
| 18级及以上  | 20%   |

### 4.5 强化结果
- 强化成功：强化等级+1
- 强化失败：强化等级-1（最低降到0）

## 5. 装备融合功能

### 5.1 功能概述
玩家可以将一个材料装备融合到主装备上，为目标装备增加附加属性。

### 5.2 融合条件
- 需要一个主装备和一个材料装备
- 两个装备必须都属于玩家
- 主装备的附加属性数量少于5条

### 5.3 融合流程
1. 玩家选择主装备和材料装备
2. 系统验证装备所有权和附加属性数量
3. 随机判定是否继承或生成附加属性
4. 材料装备被销毁
5. 主装备获得新的附加属性（如果成功）

### 5.4 附加属性获得规则
- 30% 概率继承材料装备的一条附加属性
- 70% 概率根据材料装备品级生成新的附加属性

### 5.5 新属性生成概率
| 材料装备等级 | 生成新属性概率 |
|------------|--------------|
| 1级        | 2%           |
| 2级        | 4%           |
| 3级        | 8%           |
| 4级        | 12%          |
| 5级        | 15%          |
| 6级        | 25%          |

## 6. 装备穿戴与卸下

### 6.1 穿戴装备
- 玩家可以穿戴装备到对应部位
- 同一部位只能穿戴一件装备
- 穿戴新装备时，原部位的装备会自动卸下

### 6.2 卸下装备
- 玩家可以将穿戴的装备卸下到背包

## 7. 装备属性计算

### 7.1 基础属性
- 装备的基础属性直接叠加到角色属性上

### 7.2 附加属性
- 普通附加属性：直接叠加到角色属性上
- 稀有附加属性（七宗罪）：根据属性类型有不同的计算方式：
  - 傲慢：基于当前HP值增加百分比
  - 嫉妒：增加暴击伤害倍数
  - 暴食：增加攻击速度百分比
  - 贪婪：增加固定秒杀几率
  - 色欲：增加生命恢复量
  - 暴怒：增加暴击率百分比
  - 怠惰：基于当前攻击力增加百分比

## 8. 装备系统API接口

### 8.1 锻造装备
- **接口**：`/api/v1/equipment/generate`
- **方法**：`POST`
- **参数**：
  ```json
  {
    "itemids": [1, 2, 3]  // 3个宝物ID
  }
  ```

### 8.2 强化装备
- **接口**：`/api/v1/equipment/enhance/:id`
- **方法**：`POST`
- **参数**：无（装备ID在URL中）

### 8.3 融合装备
- **接口**：`/api/v1/equipment/merge`
- **方法**：`POST`
- **参数**：
  ```json
  {
    "user_id": 1,
    "main_equipment_id": 1,    // 主装备ID
    "material_equipment_id": 2 // 材料装备ID
  }
  ```

### 8.4 穿戴装备
- **接口**：`/api/v1/equipment/equip/:id`
- **方法**：`POST`
- **参数**：无（装备ID在URL中）

### 8.5 卸下装备
- **接口**：`/api/v1/equipment/unequip/:id`
- **方法**：`POST`
- **参数**：无（装备ID在URL中）

### 8.6 获取装备模板列表
- **接口**：`/api/v1/equipment/templates`
- **方法**：`GET`
- **参数**：可选过滤条件（level, rarity, slot）

### 8.7 获取用户装备列表
- **接口**：`/api/v1/equipment/user`
- **方法**：`GET`
- **参数**：可选过滤条件（position, is_equipped）

### 8.8 获取我的装备（分类展示）
- **接口**：`/api/v1/equipment/my`
- **方法**：`GET`
- **参数**：无

## 9. 装备系统数据结构

### 9.1 装备模板（EquipmentTemplate）
```go
// 装备模板结构
type EquipmentTemplate struct {
    ID          uint    // 唯一标识
    Name        string  // 装备名称
    Level       int     // 品级：1-普通, 2-稀有, 3-史诗, 4-传说, 5-神话, 6-创世
    Slot        string  // 部位：weapon, helmet, chest, gloves, pants, boots
    HP          int     // 生命值
    Attack      int     // 攻击力
    AttackSpeed float64 // 攻速
    MoveSpeed   int     // 移速
    BulletSpeed int     // 弹速
    Drain       int     // 吸血
    Critical    int     // 暴击
    Dodge       int     // 闪避
    InstantKill int     // 秒杀
    Recovery    int     // 恢复
    Trajectory  int     // 弹道
    ImageURL    string  // 装备图片
    Description string  // 描述
    IsActive    bool    // 是否激活
    CreatedAt   int64   // 创建时间
    UpdatedAt   int64   // 更新时间
}
```

### 9.2 玩家装备（UserEquipment）
```go
// 玩家装备结构
type UserEquipment struct {
    ID              uint                   // 唯一标识
    UserID          uint                   // 玩家ID
    EquipmentID     uint                   // 装备模板ID
    IsEquipped      bool                   // 是否穿戴
    Position        string                 // 位置：backpack, equipped
    EnhanceLevel    int                    // 强化等级
    CreatedAt       int64                  // 创建时间
    UpdatedAt       int64                  // 更新时间
    EquipmentTemplate EquipmentTemplate    // 装备模板
    AdditionalAttrs  []EquipmentAdditionalAttr // 附加属性
}
```

### 9.3 装备附加属性（EquipmentAdditionalAttr）
```go
// 装备附加属性结构
type EquipmentAdditionalAttr struct {
    ID              uint   // 唯一标识
    UserEquipmentID uint   // 玩家装备ID
    AttrType        string // 属性类型
    AttrName        string // 属性名称（用于稀有属性）
    AttrValue       string // 属性值
    CreatedAt       int64  // 创建时间
    UpdatedAt       int64  // 更新时间
}
```

## 10. 装备系统管理

### 10.1 装备模板管理
- 系统管理员可以通过后台管理系统添加、修改和删除装备模板
- 装备模板包括装备的基础属性、名称、图片等信息

### 10.2 装备属性调整
- 系统管理员可以调整装备的基础属性和附加属性生成规则
- 可以调整强化成功率和金币消耗规则

### 10.3 装备活动管理
- 系统管理员可以设置装备锻造、强化、融合的活动倍率
- 可以设置限时装备和稀有装备的掉落概率

## 11. 装备系统优化建议

### 11.1 性能优化
- 装备属性计算可以缓存到Redis中，减少数据库查询
- 装备强化和融合的随机判定可以使用本地缓存，减少外部依赖

### 11.2 功能优化
- 增加装备锁定功能，防止误操作融合或销毁
- 增加装备分解功能，将不需要的装备分解为材料
- 增加装备套装系统，穿戴套装可以获得额外属性加成

### 11.3 用户体验优化
- 在强化界面显示成功率和可能的结果
- 提供装备对比功能，方便玩家选择最佳装备
- 增加装备图鉴，展示所有可获得的装备及其属性